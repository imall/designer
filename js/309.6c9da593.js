"use strict";(self["webpackChunkbos_designer"]=self["webpackChunkbos_designer"]||[]).push([[309],{9309:function(e,t,s){s.r(t),s.d(t,{default:function(){return l}});var a=function(){var e=this,t=e._self._c;return t("main",{staticClass:"w-ful box-border h-full bg-white/80 pb-[84px]"},[t("C-Back-Nav",{attrs:{title:"客戶資料查詢"}}),t("section",{staticClass:"relative z-0 mt-[52px] p-3"},[t("div",{staticClass:"mb-4 flex items-center justify-between"},[t("C-Input",{staticClass:"mb-0 mr-2 w-full",attrs:{placeholder:"搜尋姓名、手機、代號"},on:{input:e.doInitSearch},scopedSlots:e._u([{key:"endIcon",fn:function(){return[""!==e.submitForm.searchInput?t("font-awesome-icon",{staticClass:"text-rose-600",attrs:{icon:"fa-regular fa-xmark"},on:{click:function(t){e.submitForm.searchInput="",e.doInitSearch()}}}):e._e(),t("font-awesome-icon",{attrs:{icon:"fa-regular fa-magnifying-glass"}})]},proxy:!0}]),model:{value:e.submitForm.searchInput,callback:function(t){e.$set(e.submitForm,"searchInput",t)},expression:"submitForm.searchInput"}}),t("font-awesome-icon",{staticClass:"text-2xl",attrs:{icon:"fa-regular fa-filter-list"},on:{click:function(t){e.isActiveFilter=!e.isActiveFilter}}})],1),e._l(e.resultList,(function(s,a){return t("div",{key:`result${a}`,staticClass:"mb-4 flex items-center justify-between border-b border-solid border-primary/30",on:{click:function(t){return e.doRoute(s)},keypress:function(t){return e.doRoute(s)}}},[t("div",{staticClass:"w-2/12"},[e._v(e._s(+a+1>9?+a+1:"0"+(+a+1)))]),t("div",{staticClass:"w-2/12 overflow-hidden text-ellipsis whitespace-nowrap"},[e._v(" "+e._s(s.name?s.name:"--")+" ")]),t("div",{staticClass:"w-4/12"},[e._v(e._s(s.cellphone))]),t("div",{staticClass:"w-3/12 text-right"},[s.birthday?t("span",[e._v(" "+e._s(s.birthday.year&&"0"!==s.birthday.year?`${s.birthday.year}/`:"")+e._s(s.birthday.month&&"0"!==s.birthday.month?`${s.birthday.month}/`:"--.")+e._s(s.birthday.day&&"0"!==s.birthday.day?s.birthday.day:"--")+" ")]):e._e()]),t("font-awesome-icon",{staticClass:"w-1/12",attrs:{icon:"fa-solid fa-angle-right"}})],1)}))],2),t("C-Filter-Wrap",{attrs:{searchAdvanceCtx:e.searchAdvanceCtx},on:{doFunction:function(t){return e.doInitSearch(!0)},clearFunction:e.clearSearchAdvanceCtx},model:{value:e.isActiveFilter,callback:function(t){e.isActiveFilter=t},expression:"isActiveFilter"}})],1)},r=[],i=(s(7658),s(541),s(629)),n=s(5399);const o={year:"",month:"",day:"",customerIsCome:null,consumptionRange:{startDate:"",endDate:""},baseDateRange:{baseDate:"",toDate:"",dayNumber:""},designer:{latestDesignerSelected:"",latestDesigner:[{name:"請選擇",id:""}],preferDesignerSelected:"",preferDesigner:[{name:"請選擇",id:""}]}};var c={name:"customer-index",description:"客戶資料查詢的首頁",metaInfo:{title:"BeautyOS 設計師",titleTemplate:"%s | 客戶資料查詢"},mounted(){this.init()},beforeDestroy(){window.removeEventListener("scroll",this.scrollDoSearch)},data(){return{isActiveFilter:!1,submitForm:{searchInput:"",pageOffset:0,isEnd:!1},totalPage:0,isGetting:!1,searchAdvanceCtx:{year:"",month:"",day:"",customerIsCome:null,consumptionRange:{startDate:"",endDate:""},baseDateRange:{baseDate:"",toDate:"",dayNumber:""},designer:{latestDesignerSelected:"",latestDesigner:[],preferDesignerSelected:"",preferDesigner:[]}},resultList:[],isloading:!1}},methods:{async init(){await this.doSearch(),await this.getAllDesigner()},async clearSearchAdvanceCtx(){this.searchAdvanceCtx=JSON.parse(JSON.stringify(o))},doRoute(e){this.$router.push({name:"Customer-UserInfo",query:{id:e.id}})},doInitSearch(e){const t=this.submitForm.searchInput;setTimeout((()=>{t===this.submitForm.searchInput&&(this.submitForm.pageOffset=0,this.doSearch())}),e?0:500)},async doSearch(){const e={keyword:this.submitForm.searchInput,pageOffset:this.submitForm.pageOffset,pageLimit:20,customerIsCome:this.searchAdvanceCtx.customerIsCome,preferDesigner:this.searchAdvanceCtx.designer.preferDesignerSelected,latestDesigner:this.searchAdvanceCtx.designer.latestDesignerSelected};""===this.searchAdvanceCtx.year&&""===this.searchAdvanceCtx.month||(e.birthday={},e.birthday.year=`${this.searchAdvanceCtx.year}`,e.birthday.month=n.Z.find((e=>e.label===this.searchAdvanceCtx.month))?n.Z.find((e=>e.label===this.searchAdvanceCtx.month)).value:"",e.birthday.day=""),""!==this.searchAdvanceCtx.consumptionRange.startDate&&(e.consumptionRange={},e.consumptionRange.startDate=this.searchAdvanceCtx.consumptionRange.startDate,e.consumptionRange.endDate=this.searchAdvanceCtx.consumptionRange.endDate),""!==this.searchAdvanceCtx.baseDateRange.baseDate&&(e.baseDateRange={},e.baseDateRange.baseDate=this.searchAdvanceCtx.baseDateRange.baseDate),""!==this.searchAdvanceCtx.baseDateRange.toDate&&(e.baseDateRange||(e.baseDateRange={}),e.baseDateRange.toDate=this.searchAdvanceCtx.baseDateRange.toDate),""!==this.searchAdvanceCtx.baseDateRange.dayNumber&&(e.baseDateRange||(e.baseDateRange={}),e.baseDateRange.dayNumber=Number(this.searchAdvanceCtx.baseDateRange.dayNumber));const t=await this.$api.customersWithoutSorting(e),{data:s,errors:a}=t.data;a||(this.totalPage=Math.ceil(s.customersWithoutSorting.totalCount/20)-1,this.submitForm.isEnd=1===Math.ceil(s.customersWithoutSorting.totalCount/20),this.resultList=s.customersWithoutSorting.customers,this.submitForm.pageOffset<this.totalPage&&window.addEventListener("scroll",this.scrollDoSearch),this.isActiveFilter=!1)},async scrollDoSearch(){const e=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.clientHeight||document.body.clientHeight,s=document.documentElement.scrollHeight||document.body.scrollHeight;if(!this.submitForm.isEnd&&!this.isGetting&&e+t>=s-50){this.isGetting=!0,this.submitForm.pageOffset+=1,this.submitForm.pageOffset>=this.totalPage&&(this.submitForm.isEnd=!0,window.removeEventListener("scroll",this.scrollDoSearch));const e={merchantId:this.currentMechantId,keyword:this.submitForm.searchInput,pageOffset:this.submitForm.pageOffset,pageLimit:20},t=await this.$api.customers(e),{data:s,errors:a}=t.data;if(a)return;this.isGetting=!1,this.resultList=this.resultList.concat(s.customers.customers)}},async getAllDesigner(){const e=JSON.parse(localStorage.getItem("ML_DESIGN")),t=e.userAuthorizeList.filter((e=>"可查詢全店客資"===e.pageName)),s={MerchantId:e.currentMechantId,usagelimit:"EMPLOYEE_LIST"},a=[{id:"",name:"請選擇"},{id:e.user.id,name:e.user.name}];if(t[0].authority){const e=await this.$api.users(s),{data:t,errors:a}=e.data;if(a)return;t.users.users.unshift({id:"",name:"請選擇"}),this.searchAdvanceCtx.designer.latestDesigner=t.users.users,this.searchAdvanceCtx.designer.preferDesigner=t.users.users,o.designer.latestDesigner=t.users.users,o.designer.preferDesigner=t.users.users}else this.searchAdvanceCtx.designer.latestDesigner=a,this.searchAdvanceCtx.designer.preferDesigner=a,o.designer.latestDesigner=a,o.designer.preferDesigner=a}},computed:{...(0,i.rn)("userInfo",["userInfo","currentMechantId"]),isReviewResult(){return this.reviewResult.length},isOrderResult(){return this.orderResult.length}}},u=c,h=s(3736),d=(0,h.Z)(u,a,r,!1,null,null,null),l=d.exports},5117:function(e,t,s){var a=s(6330),r=TypeError;e.exports=function(e,t){if(!delete e[t])throw r("Cannot delete property "+a(t)+" of "+a(e))}},541:function(e,t,s){var a=s(2109),r=s(7908),i=s(6244),n=s(3658),o=s(5117),c=s(7207),u=1!==[].unshift(0),h=!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(e){return e instanceof TypeError}}();a({target:"Array",proto:!0,arity:1,forced:u||h},{unshift:function(e){var t=r(this),s=i(t),a=arguments.length;if(a){c(s+a);var u=s;while(u--){var h=u+a;u in t?t[h]=t[u]:o(t,h)}for(var d=0;d<a;d++)t[d]=arguments[d]}return n(t,s+a)}})}}]);
//# sourceMappingURL=309.6c9da593.js.map